

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>omegaml.mixins.store.extdmeta &mdash; omega-ml 0.17.0-rc1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css?v=7ca4e891" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=1c035cde"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            omega-ml
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../admin/index.html">Deploying omega-ml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devguide/index.html">Extending omega-ml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changes/index.html">Changes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">omega-ml</a>
      </nav>

      <div class="wy-nav-content">


        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">omegaml.mixins.store.extdmeta</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for omegaml.mixins.store.extdmeta</h1><div class="highlight"><pre>
<span></span><span class="linenos">  1</span><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
<span class="linenos">  2</span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="linenos">  3</span><span class="kn">from</span><span class="w"> </span><span class="nn">apispec</span><span class="w"> </span><span class="kn">import</span> <span class="n">APISpec</span>
<span class="linenos">  4</span><span class="kn">from</span><span class="w"> </span><span class="nn">apispec.ext.marshmallow</span><span class="w"> </span><span class="kn">import</span> <span class="n">MarshmallowPlugin</span>
<span class="linenos">  5</span><span class="kn">from</span><span class="w"> </span><span class="nn">marshmallow</span><span class="w"> </span><span class="kn">import</span> <span class="n">fields</span><span class="p">,</span> <span class="n">Schema</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="kn">from</span><span class="w"> </span><span class="nn">omegaml.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">markup</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="k">class</span><span class="w"> </span><span class="nc">SignatureMixin</span><span class="p">:</span>
<span class="linenos"> 11</span><span class="w">    </span><span class="sd">&quot;&quot;&quot; Associate a models corresponding dataset</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="sd">    This provides methods to record additional metadata on models.</span>
<span class="linenos"> 14</span><span class="sd">    On runtime-called calls, this additional metadata is used to</span>
<span class="linenos"> 15</span><span class="sd">    provide defaults for Xname, Yname, rName respectively.</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="sd">    Usage::</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="sd">        # recording information</span>
<span class="linenos"> 20</span><span class="sd">        om.models.link_dataset(&#39;modelname&#39;, Xname=..., Yname=...)</span>
<span class="linenos"> 21</span><span class="sd">        om.models.link_docs(&#39;modelname&#39;, doc_or_ref)</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="sd">        # using default dataset names, using the metadata.attributes[&#39;dataset&#39;] entry</span>
<span class="linenos"> 24</span><span class="sd">        om.runtime.model(&#39;mymodel&#39;).fit(&#39;*&#39;, &#39;*&#39;)</span>
<span class="linenos"> 25</span><span class="sd">        om.runtime.model(&#39;mymodel&#39;).predict(&#39;*&#39;)</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="sd">    Notes:</span>
<span class="linenos"> 28</span><span class="sd">        - Provides pre/post processing for model actions. Currently fit(), predict()</span>
<span class="linenos"> 29</span><span class="sd">        - Pre/post processing is triggered when called as</span>
<span class="linenos"> 30</span><span class="sd">          ModelBackend.perform(&#39;method&#39;, *args, **kwargs)</span>
<span class="linenos"> 31</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span>    <span class="c1"># terms used in this class</span>
<span class="linenos"> 34</span>    <span class="c1"># -- &quot;datatype&quot; =&gt; marshmallow Schema class/instance</span>
<span class="linenos"> 35</span>    <span class="c1"># -- &quot;schema&quot; =&gt; &quot;schemas&quot; component</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span>    <span class="k">def</span><span class="w"> </span><span class="nf">link_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">doc_or_ref</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos"> 38</span><span class="w">        </span><span class="sd">&quot;&quot;&quot; set or link documentation returned by om.models.help()</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="sd">        Args:</span>
<span class="linenos"> 41</span><span class="sd">            name: the model name</span>
<span class="linenos"> 42</span><span class="sd">            doc_or_ref: the docstring or the URL to a web page</span>
<span class="linenos"> 43</span><span class="sd">            **kwargs:</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span><span class="sd">        Returns:</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 48</span>        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos"> 49</span>        <span class="n">meta</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc_or_ref</span>
<span class="linenos"> 50</span>        <span class="k">return</span> <span class="n">meta</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span>    <span class="k">def</span><span class="w"> </span><span class="nf">link_datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 53</span>                      <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 54</span>                      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos"> 55</span><span class="w">        </span><span class="sd">&quot;&quot;&quot; link a Schema to a model or script</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="sd">        Args:</span>
<span class="linenos"> 58</span><span class="sd">            name (str): the name of the model, script</span>
<span class="linenos"> 59</span><span class="sd">            X (Schema|list): the schema for the X data (dataX), applies to models, scripts. Pass [Schema] to</span>
<span class="linenos"> 60</span><span class="sd">               indicate many objects of type Schema.</span>
<span class="linenos"> 61</span><span class="sd">            Y (Schema|list): the schema for the Y data (dataY), applies to models only. Pass [Schema] to</span>
<span class="linenos"> 62</span><span class="sd">               indicate many objects of type Schema.</span>
<span class="linenos"> 63</span><span class="sd">            result (Schema): the schema for the successful result, applies to scripts only. Pass [Schema] to</span>
<span class="linenos"> 64</span><span class="sd">               indicate many objects of type Schema.</span>
<span class="linenos"> 65</span><span class="sd">            errors (list|dict): list of tuples or dict of Schema|Exception =&gt; http status code to indicate errors</span>
<span class="linenos"> 66</span><span class="sd">            orient (str): the datatype orientation, defaults to &#39;columns&#39; for models, &#39;records&#39; for datasets and scripts</span>
<span class="linenos"> 67</span><span class="sd">            actions (list|dict): the list of valid actions [&#39;predict&#39;, ...],</span>
<span class="linenos"> 68</span><span class="sd">               or a list of tuples to map actions to http methods [(&#39;predict&#39;, [&#39;post&#39;, ...]), ...]. If</span>
<span class="linenos"> 69</span><span class="sd">               the http method is not specified, it is assumed as &#39;post&#39;</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="sd">        Returns:</span>
<span class="linenos"> 72</span><span class="sd">            Metadata</span>
<span class="linenos"> 73</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 74</span>        <span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos"> 75</span>        <span class="k">if</span> <span class="n">actions</span><span class="p">:</span>
<span class="linenos"> 76</span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
<span class="linenos"> 77</span>                <span class="c1"># list of strings</span>
<span class="linenos"> 78</span>                <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="n">action</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">}</span>
<span class="linenos"> 79</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 80</span>                <span class="c1"># list of tuples [(http_method, [action, ...])] or dict</span>
<span class="linenos"> 81</span>                <span class="n">actions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>
<span class="linenos"> 82</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 83</span>            <span class="n">actions</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 84</span>        <span class="n">existing</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;signature&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos"> 85</span>        <span class="c1"># determine object or array</span>
<span class="linenos"> 86</span>        <span class="n">is_many</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">T</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;many&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 87</span>        <span class="n">many_type</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">T</span><span class="p">:</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">X</span>
<span class="linenos"> 88</span>        <span class="n">Xmany</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">many_type</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="k">if</span> <span class="n">is_many</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="linenos"> 89</span>        <span class="n">Ymany</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">many_type</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span> <span class="k">if</span> <span class="n">is_many</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="linenos"> 90</span>        <span class="n">Rmany</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">many_type</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="k">if</span> <span class="n">is_many</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="linenos"> 91</span>        <span class="n">iter_errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
<span class="linenos"> 92</span>                       <span class="k">else</span> <span class="p">((</span><span class="n">E</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="k">for</span> <span class="n">E</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="k">else</span> <span class="p">[])</span>
<span class="linenos"> 93</span>        <span class="n">errors</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 94</span>            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">many_type</span><span class="p">(</span><span class="n">E</span><span class="p">))</span> <span class="k">if</span> <span class="n">is_many</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span> <span class="n">status</span>
<span class="linenos"> 95</span>            <span class="k">for</span> <span class="n">E</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">iter_errors</span><span class="p">}</span>
<span class="linenos"> 96</span>        <span class="c1"># build signature specification</span>
<span class="linenos"> 97</span>        <span class="n">is_schema</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">T</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Schema</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Schema</span><span class="p">)</span>
<span class="linenos"> 98</span>        <span class="n">ExceptionSchema</span> <span class="o">=</span> <span class="n">Schema</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">()},</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">Exception&#39;</span><span class="p">)</span>
<span class="linenos"> 99</span>        <span class="n">meta</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;signature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">100</span>            <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">101</span>                <span class="s1">&#39;datatype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">schema_name</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos">102</span>                <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_from_datatype</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>
<span class="linenos">103</span>                <span class="s1">&#39;many&#39;</span><span class="p">:</span> <span class="n">Xmany</span><span class="p">,</span>
<span class="linenos">104</span>            <span class="p">}</span> <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<span class="linenos">105</span>            <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">106</span>                <span class="s1">&#39;datatype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">schema_name</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos">107</span>                <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_from_datatype</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span>
<span class="linenos">108</span>                <span class="s1">&#39;many&#39;</span><span class="p">:</span> <span class="n">Ymany</span><span class="p">,</span>
<span class="linenos">109</span>            <span class="p">}</span> <span class="k">if</span> <span class="n">Y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<span class="linenos">110</span>            <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">111</span>                <span class="s1">&#39;datatype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">schema_name</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos">112</span>                <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_from_datatype</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
<span class="linenos">113</span>                <span class="s1">&#39;many&#39;</span><span class="p">:</span> <span class="n">Rmany</span><span class="p">,</span>
<span class="linenos">114</span>            <span class="p">}</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">),</span>
<span class="linenos">115</span>            <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">116</span>                <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">):</span> <span class="p">{</span>
<span class="linenos">117</span>                    <span class="s1">&#39;datatype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">E</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">schema_name</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="linenos">118</span>                    <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_from_datatype</span><span class="p">(</span><span class="n">E</span> <span class="k">if</span> <span class="n">is_schema</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="k">else</span> <span class="n">ExceptionSchema</span><span class="p">),</span>
<span class="linenos">119</span>                    <span class="s1">&#39;many&#39;</span><span class="p">:</span> <span class="n">many</span><span class="p">,</span>
<span class="linenos">120</span>                    <span class="s1">&#39;exception&#39;</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">(),</span> <span class="ne">Exception</span><span class="p">),</span>
<span class="linenos">121</span>                <span class="p">}</span> <span class="k">for</span> <span class="p">(</span><span class="n">many</span><span class="p">,</span> <span class="n">E</span><span class="p">),</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="linenos">122</span>            <span class="p">}</span> <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">),</span>
<span class="linenos">123</span>            <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="n">actions</span><span class="p">,</span>
<span class="linenos">124</span>            <span class="s1">&#39;orient&#39;</span><span class="p">:</span> <span class="n">orient</span><span class="p">,</span>
<span class="linenos">125</span>        <span class="p">}</span>
<span class="linenos">126</span>        <span class="k">return</span> <span class="n">meta</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="linenos">127</span>
<span class="linenos">128</span>    <span class="k">def</span><span class="w"> </span><span class="nf">link_swagger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specs</span><span class="p">,</span> <span class="n">operations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">129</span><span class="w">        </span><span class="sd">&quot;&quot;&quot; link swagger specs to operations</span>
<span class="linenos">130</span>
<span class="linenos">131</span><span class="sd">        Args:</span>
<span class="linenos">132</span><span class="sd">            specs (dict|filename): the swagger specifications</span>
<span class="linenos">133</span><span class="sd">            operations (list|dict): the operations to support (names of services, models),</span>
<span class="linenos">134</span><span class="sd">                if dict, a mapping of { &#39;/api/path&#39;: &#39;name#action#method&#39; }, where name is</span>
<span class="linenos">135</span><span class="sd">                the name of a service or model, action is the method to call (e.g. predict),</span>
<span class="linenos">136</span><span class="sd">                and method is the http method (e.g. post)</span>
<span class="linenos">137</span>
<span class="linenos">138</span><span class="sd">        Returns:</span>
<span class="linenos">139</span><span class="sd">            list of mapped Metadata</span>
<span class="linenos">140</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">141</span>        <span class="n">specs</span> <span class="o">=</span> <span class="n">specs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">specs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">markup</span><span class="p">(</span><span class="n">specs</span><span class="p">)</span>
<span class="linenos">142</span>        <span class="k">assert</span> <span class="n">specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;swagger&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;2.0&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Only swagger version 2.0 is currently supported.&quot;</span>
<span class="linenos">143</span>        <span class="n">paths</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s1">&#39;paths&#39;</span><span class="p">]</span>
<span class="linenos">144</span>        <span class="n">definitions</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s1">&#39;definitions&#39;</span><span class="p">]</span>
<span class="linenos">145</span>        <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">146</span>        <span class="n">operations</span> <span class="o">=</span> <span class="n">operations</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="linenos">147</span>        <span class="n">metas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">148</span>
<span class="linenos">149</span>        <span class="k">def</span><span class="w"> </span><span class="nf">pathspecs</span><span class="p">():</span>
<span class="linenos">150</span>            <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">pathspec</span> <span class="ow">in</span> <span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">151</span>                <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">opspec</span> <span class="ow">in</span> <span class="n">pathspec</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">152</span>                    <span class="k">yield</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">opspec</span>
<span class="linenos">153</span>
<span class="linenos">154</span>        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">opspec</span> <span class="ow">in</span> <span class="n">pathspecs</span><span class="p">():</span>
<span class="linenos">155</span>            <span class="c1"># operation mapping</span>
<span class="linenos">156</span>            <span class="c1"># -- format: name#action#method[,method]</span>
<span class="linenos">157</span>            <span class="c1"># -- name is the model or service name</span>
<span class="linenos">158</span>            <span class="c1"># -- action is the method to call (e.g. predict)</span>
<span class="linenos">159</span>            <span class="c1"># -- method(s) is the name of the http method</span>
<span class="linenos">160</span>            <span class="n">opId</span> <span class="o">=</span> <span class="n">opspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operationId&#39;</span><span class="p">)</span>
<span class="linenos">161</span>            <span class="k">if</span> <span class="n">opId</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">162</span>                <span class="c1"># extract from given operations spec</span>
<span class="linenos">163</span>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="linenos">164</span>                    <span class="n">opId</span> <span class="o">=</span> <span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="linenos">165</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">166</span>                    <span class="c1"># fallback to default operation</span>
<span class="linenos">167</span>                    <span class="n">pathName</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">168</span>                    <span class="n">opId</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pathName</span><span class="si">}</span><span class="s1">#predict#post&#39;</span>
<span class="linenos">169</span>            <span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="n">opId</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="linenos">170</span>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="linenos">171</span>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">, ignored.&quot;</span><span class="p">)</span>
<span class="linenos">172</span>                <span class="k">continue</span>
<span class="linenos">173</span>            <span class="n">methods</span> <span class="o">=</span> <span class="n">methods</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="linenos">174</span>            <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">action</span><span class="p">,</span> <span class="n">methods</span><span class="p">))</span>
<span class="linenos">175</span>            <span class="c1"># parameters</span>
<span class="linenos">176</span>            <span class="n">params</span> <span class="o">=</span> <span class="n">opspec</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
<span class="linenos">177</span>            <span class="k">for</span> <span class="n">prmspec</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
<span class="linenos">178</span>                <span class="k">if</span> <span class="n">prmspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;body&#39;</span><span class="p">:</span>
<span class="linenos">179</span>                    <span class="k">continue</span>
<span class="linenos">180</span>                <span class="c1"># resolve schema spec</span>
<span class="linenos">181</span>                <span class="c1"># -- either direct spec of schema</span>
<span class="linenos">182</span>                <span class="c1"># -- or $ref: #/definitions/&lt;name&gt;, where name is the key into definitions</span>
<span class="linenos">183</span>                <span class="n">schemaSpec</span> <span class="o">=</span> <span class="n">prmspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schema&#39;</span><span class="p">)</span>
<span class="linenos">184</span>                <span class="n">Xis_many</span> <span class="o">=</span> <span class="n">schemaSpec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span>
<span class="linenos">185</span>                <span class="n">schemaRef</span> <span class="o">=</span> <span class="n">schemaSpec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;$ref&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">Xis_many</span> <span class="k">else</span> <span class="n">schemaSpec</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;$ref&#39;</span><span class="p">)</span>
<span class="linenos">186</span>                <span class="n">Xschema</span> <span class="o">=</span> <span class="n">schemaSpec</span> <span class="k">if</span> <span class="n">schemaRef</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schemaRef</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">187</span>                <span class="k">break</span>
<span class="linenos">188</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">189</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No body found, cannot generate X datatype&quot;</span><span class="p">)</span>
<span class="linenos">190</span>                <span class="n">Xschema</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">191</span>                <span class="n">Xis_many</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">192</span>            <span class="n">resps</span> <span class="o">=</span> <span class="n">opspec</span><span class="p">[</span><span class="s1">&#39;responses&#39;</span><span class="p">]</span>
<span class="linenos">193</span>            <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">194</span>            <span class="n">Yschema</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">195</span>            <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">respspec</span> <span class="ow">in</span> <span class="n">resps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">196</span>                <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;200&#39;</span><span class="p">:</span>
<span class="linenos">197</span>                    <span class="n">schemaSpec</span> <span class="o">=</span> <span class="n">respspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schema&#39;</span><span class="p">)</span>
<span class="linenos">198</span>                    <span class="n">Yis_many</span> <span class="o">=</span> <span class="n">schemaSpec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span>
<span class="linenos">199</span>                    <span class="n">schemaRef</span> <span class="o">=</span> <span class="n">schemaSpec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;$ref&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">Yis_many</span> <span class="k">else</span> <span class="n">schemaSpec</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;$ref&#39;</span><span class="p">)</span>
<span class="linenos">200</span>                    <span class="n">Yschema</span> <span class="o">=</span> <span class="n">schemaSpec</span> <span class="k">if</span> <span class="n">schemaRef</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schemaRef</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">201</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">202</span>                    <span class="n">schemaSpec</span> <span class="o">=</span> <span class="n">respspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schema&#39;</span><span class="p">)</span>
<span class="linenos">203</span>                    <span class="n">Eis_many</span> <span class="o">=</span> <span class="n">schemaSpec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span>
<span class="linenos">204</span>                    <span class="n">schemaRef</span> <span class="o">=</span> <span class="n">schemaSpec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;$ref&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">Eis_many</span> <span class="k">else</span> <span class="n">schemaSpec</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;$ref&#39;</span><span class="p">)</span>
<span class="linenos">205</span>                    <span class="n">Eschema</span> <span class="o">=</span> <span class="n">schemaSpec</span> <span class="k">if</span> <span class="n">schemaRef</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schemaRef</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">206</span>                    <span class="n">Edtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype_from_schema</span><span class="p">(</span><span class="n">Eschema</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="n">Eis_many</span><span class="p">)</span>
<span class="linenos">207</span>                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="nb">type</span><span class="p">(</span><span class="n">Edtype</span><span class="p">)]</span> <span class="k">if</span> <span class="n">Eis_many</span> <span class="k">else</span> <span class="n">Edtype</span><span class="p">,</span> <span class="n">code</span><span class="p">))</span>
<span class="linenos">208</span>            <span class="k">if</span> <span class="n">Yschema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">209</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No response 200 found, cannot generate Y datatype&quot;</span><span class="p">)</span>
<span class="linenos">210</span>                <span class="n">Yschema</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">211</span>                <span class="n">Yis_many</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">212</span>            <span class="c1"># finally link</span>
<span class="linenos">213</span>            <span class="n">Xdtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype_from_schema</span><span class="p">(</span><span class="n">Xschema</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">Input_</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="n">Xis_many</span><span class="p">)</span>
<span class="linenos">214</span>            <span class="n">Ydtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype_from_schema</span><span class="p">(</span><span class="n">Yschema</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">Output_</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="n">Yis_many</span><span class="p">)</span>
<span class="linenos">215</span>            <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_datatype</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">Xdtype</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Ydtype</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
<span class="linenos">216</span>            <span class="n">metas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
<span class="linenos">217</span>        <span class="k">return</span> <span class="n">metas</span>
<span class="linenos">218</span>
<span class="linenos">219</span>    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">220</span>        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">221</span>        <span class="n">signature</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;signature&#39;</span><span class="p">)</span>
<span class="linenos">222</span>
<span class="linenos">223</span>        <span class="k">def</span><span class="w"> </span><span class="nf">_do_validate</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="linenos">224</span>            <span class="n">vv</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos">225</span>            <span class="n">v</span> <span class="o">=</span> <span class="n">vv</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
<span class="linenos">226</span>            <span class="n">status_code</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">227</span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
<span class="linenos">228</span>                <span class="n">status_code</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">400</span>
<span class="linenos">229</span>                <span class="n">schema</span> <span class="o">=</span> <span class="p">(</span><span class="n">signature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status_code</span><span class="p">),</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schema&#39;</span><span class="p">)</span>
<span class="linenos">230</span>                <span class="n">many</span> <span class="o">=</span> <span class="p">(</span><span class="n">signature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status_code</span><span class="p">),</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;many&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos">231</span>                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">v</span>  <span class="c1"># parse exception value instead of instance</span>
<span class="linenos">232</span>                <span class="n">v</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span> <span class="k">else</span> <span class="n">v</span>
<span class="linenos">233</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">234</span>                <span class="n">schema</span> <span class="o">=</span> <span class="p">(</span><span class="n">signature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schema&#39;</span><span class="p">)</span>
<span class="linenos">235</span>                <span class="n">many</span> <span class="o">=</span> <span class="p">(</span><span class="n">signature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;many&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos">236</span>            <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
<span class="linenos">237</span>                <span class="n">Schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype_from_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">238</span>                <span class="n">Schema</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="n">many</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="linenos">239</span>
<span class="linenos">240</span>        <span class="k">if</span> <span class="n">signature</span><span class="p">:</span>
<span class="linenos">241</span>            <span class="n">nop</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">()</span>
<span class="linenos">242</span>            <span class="c1"># if we have an exception, process as error</span>
<span class="linenos">243</span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
<span class="linenos">244</span>                <span class="n">error</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">,</span> <span class="kc">None</span>
<span class="linenos">245</span>            <span class="c1"># validate all inputs provided</span>
<span class="linenos">246</span>            <span class="n">_do_validate</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span> <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nop</span><span class="p">()</span>
<span class="linenos">247</span>            <span class="n">_do_validate</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span> <span class="k">if</span> <span class="n">Y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nop</span><span class="p">()</span>
<span class="linenos">248</span>            <span class="n">_do_validate</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nop</span><span class="p">()</span>
<span class="linenos">249</span>            <span class="n">_do_validate</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nop</span><span class="p">()</span>
<span class="linenos">250</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">251</span>
<span class="linenos">252</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_datatype_from_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="linenos">253</span>        <span class="c1"># from an apispec schema, create a marshmallow Schema</span>
<span class="linenos">254</span>        <span class="c1">#</span>
<span class="linenos">255</span>        <span class="c1"># orient &#39;records&#39; =&gt; every instance of the Schema reflects one item (default)</span>
<span class="linenos">256</span>        <span class="c1">#                     where each field is a distinct value of its type</span>
<span class="linenos">257</span>        <span class="c1">#        &#39;columns&#39; =&gt; every instance of the Schema reflects a full dataset, where</span>
<span class="linenos">258</span>        <span class="c1">#                     where each field is a list of values of its type</span>
<span class="linenos">259</span>        <span class="c1"># many   if True, the Schema has Schema.many = True</span>
<span class="linenos">260</span>        <span class="c1"># map OpenAPI 3.x to marshmallow.fields</span>
<span class="linenos">261</span>        <span class="c1"># -- nested types are not supported (except arrays)</span>
<span class="linenos">262</span>        <span class="c1"># https://swagger.io/specification/</span>
<span class="linenos">263</span>        <span class="c1"># https://marshmallow.readthedocs.io/en/stable/marshmallow.fields.html</span>
<span class="linenos">264</span>        <span class="c1"># convert apispec schema to marshmallow Schema</span>
<span class="linenos">265</span>        <span class="c1"># -- type conversions from apispec to marshmallow</span>
<span class="linenos">266</span>        <span class="n">TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">267</span>            <span class="s1">&#39;integer&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
<span class="linenos">268</span>            <span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>
<span class="linenos">269</span>            <span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
<span class="linenos">270</span>            <span class="s1">&#39;string.byte&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
<span class="linenos">271</span>            <span class="s1">&#39;string.date-time&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
<span class="linenos">272</span>            <span class="s1">&#39;string.date&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span>
<span class="linenos">273</span>            <span class="s1">&#39;array&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">List</span><span class="p">,</span>
<span class="linenos">274</span>            <span class="s1">&#39;boolean&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span>
<span class="linenos">275</span>            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
<span class="linenos">276</span>            <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
<span class="linenos">277</span>            <span class="s1">&#39;object&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Raw</span><span class="p">,</span>
<span class="linenos">278</span>        <span class="p">}</span>
<span class="linenos">279</span>        <span class="c1"># -- properties conversion from apispec to marhsmallow</span>
<span class="linenos">280</span>        <span class="n">PROPS_MAP</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">281</span>            <span class="s1">&#39;nullable&#39;</span><span class="p">:</span> <span class="s1">&#39;allow_none&#39;</span><span class="p">,</span>
<span class="linenos">282</span>        <span class="p">}</span>
<span class="linenos">283</span>        <span class="c1"># -- determine Schema type, Fields and respective properties</span>
<span class="linenos">284</span>        <span class="n">prop</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span>
<span class="linenos">285</span>        <span class="n">sdict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">286</span>        <span class="k">for</span> <span class="n">prop</span><span class="p">,</span> <span class="n">pspec</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">287</span>            <span class="c1"># -- ptype is the apispec type of the property (e.g. integer, string, array)</span>
<span class="linenos">288</span>            <span class="n">ptype</span> <span class="o">=</span> <span class="n">pspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
<span class="linenos">289</span>            <span class="c1"># -- fptype is the formatted type (fully qualified) of the property (e.g. string.byte, string.date-time)</span>
<span class="linenos">290</span>            <span class="n">pformat</span> <span class="o">=</span> <span class="n">pspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">291</span>            <span class="n">fptype</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">ptype</span><span class="p">,</span> <span class="n">pformat</span><span class="p">))</span>
<span class="linenos">292</span>            <span class="c1"># -- ftype is the marshmallow type of the property (e.g. fields.Integer, fields.String, fields.List)</span>
<span class="linenos">293</span>            <span class="n">ftype</span> <span class="o">=</span> <span class="n">TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fptype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="linenos">294</span>            <span class="c1"># -- props are the properties of the field (e.g. nullable, allow_none)</span>
<span class="linenos">295</span>            <span class="c1">#    in case of arrays, a nested type is determined (TODO: support nested schemas)</span>
<span class="linenos">296</span>            <span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="n">PROPS_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pspec</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">PROPS_MAP</span><span class="p">}</span>
<span class="linenos">297</span>            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
<span class="linenos">298</span>                <span class="n">ptype</span> <span class="o">=</span> <span class="n">TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pspec</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span>
<span class="linenos">299</span>                <span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span> <span class="k">if</span> <span class="n">ptype</span> <span class="k">else</span> <span class="n">ftype</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">Dict</span><span class="p">())</span>
<span class="linenos">300</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">301</span>                <span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span><span class="p">(</span><span class="o">**</span><span class="n">props</span><span class="p">)</span>
<span class="linenos">302</span>            <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s1">&#39;columns&#39;</span><span class="p">:</span>
<span class="linenos">303</span>                <span class="n">ftype</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">ftype</span><span class="p">)</span>
<span class="linenos">304</span>            <span class="n">sdict</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">ftype</span>
<span class="linenos">305</span>        <span class="c1"># -- finally, create the schema</span>
<span class="linenos">306</span>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">sdict</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="linenos">307</span>        <span class="n">schema</span><span class="o">.</span><span class="n">error_messages</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">308</span>            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;invalid input for schema </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos">309</span>        <span class="p">}</span>
<span class="linenos">310</span>        <span class="k">return</span> <span class="n">schema</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">many</span> <span class="k">else</span> <span class="n">schema</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">311</span>
<span class="linenos">312</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_datatype_from_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">):</span>
<span class="linenos">313</span>        <span class="c1"># https://pbpython.com/pandas_dtypes.html</span>
<span class="linenos">314</span>        <span class="n">TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">315</span>            <span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
<span class="linenos">316</span>            <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
<span class="linenos">317</span>            <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>
<span class="linenos">318</span>            <span class="s2">&quot;dict&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Raw</span><span class="p">,</span>
<span class="linenos">319</span>            <span class="s2">&quot;bool&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span>
<span class="linenos">320</span>            <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
<span class="linenos">321</span>            <span class="s2">&quot;timedelta[ns]&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
<span class="linenos">322</span>            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span>
<span class="linenos">323</span>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
<span class="linenos">324</span>        <span class="p">}</span>
<span class="linenos">325</span>        <span class="n">kind_meta</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;kind_meta&#39;</span><span class="p">]</span>
<span class="linenos">326</span>        <span class="n">dtypes</span> <span class="o">=</span> <span class="n">kind_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dtypes&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">327</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="linenos">328</span>        <span class="n">sdict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">329</span>        <span class="n">infer</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
<span class="linenos">330</span>        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">colType</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">331</span>            <span class="k">if</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
<span class="linenos">332</span>                <span class="k">continue</span>
<span class="linenos">333</span>            <span class="c1"># orient == &#39;records&#39; means every item is one value</span>
<span class="linenos">334</span>            <span class="c1">#        == &#39;columns&#39; means every item is a list of values</span>
<span class="linenos">335</span>            <span class="n">ftype</span> <span class="o">=</span> <span class="n">TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">infer</span><span class="p">(</span><span class="n">colType</span><span class="p">))</span> <span class="ow">or</span> <span class="n">TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="linenos">336</span>            <span class="n">sdict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ftype</span><span class="p">()</span> <span class="k">if</span> <span class="n">orient</span> <span class="o">==</span> <span class="s1">&#39;records&#39;</span> <span class="k">else</span> <span class="n">fields</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">ftype</span><span class="p">)</span>
<span class="linenos">337</span>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">sdict</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="linenos">338</span>        <span class="n">schema</span><span class="o">.</span><span class="n">error_messages</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">339</span>            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;invalid input for schema </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="linenos">340</span>        <span class="p">}</span>
<span class="linenos">341</span>        <span class="k">return</span> <span class="n">schema</span>
<span class="linenos">342</span>
<span class="linenos">343</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_schema_from_datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datatype</span><span class="p">):</span>
<span class="linenos">344</span>        <span class="n">spec</span> <span class="o">=</span> <span class="n">APISpec</span><span class="p">(</span>
<span class="linenos">345</span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;omega-ml service&quot;</span><span class="p">,</span>
<span class="linenos">346</span>            <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="linenos">347</span>            <span class="n">openapi_version</span><span class="o">=</span><span class="s2">&quot;3.0&quot;</span><span class="p">,</span>
<span class="linenos">348</span>            <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">MarshmallowPlugin</span><span class="p">()],</span>
<span class="linenos">349</span>        <span class="p">)</span>
<span class="linenos">350</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span>
<span class="linenos">351</span>        <span class="n">spec</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
<span class="linenos">352</span>        <span class="k">return</span> <span class="n">spec</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;components&#39;</span><span class="p">][</span><span class="s1">&#39;schemas&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
<span class="linenos">353</span>
<span class="linenos">354</span>
<span class="linenos">355</span><span class="k">class</span><span class="w"> </span><span class="nc">ScriptSignatureMixin</span><span class="p">(</span><span class="n">SignatureMixin</span><span class="p">):</span>
<span class="linenos">356</span>    <span class="nd">@classmethod</span>
<span class="linenos">357</span>    <span class="k">def</span><span class="w"> </span><span class="nf">supports</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">358</span>        <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="n">prefix</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;scripts/&#39;</span><span class="p">)</span>
<span class="linenos">359</span>
<span class="linenos">360</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scriptname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">361</span>        <span class="n">validate_kwargs</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">362</span>            <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<span class="linenos">363</span>            <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="linenos">364</span>        <span class="p">}</span>
<span class="linenos">365</span>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">scriptname</span><span class="p">,</span> <span class="o">**</span><span class="n">validate_kwargs</span><span class="p">)</span>
<span class="linenos">366</span>        <span class="k">return</span> <span class="p">(</span><span class="n">scriptname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="n">kwargs</span>
<span class="linenos">367</span>
<span class="linenos">368</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_post_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">scriptname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">om</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">369</span>        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">scriptname</span><span class="p">)</span>
<span class="linenos">370</span>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">scriptname</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
<span class="linenos">371</span>        <span class="k">return</span> <span class="n">result</span>
<span class="linenos">372</span>
<span class="linenos">373</span>
<div class="viewcode-block" id="ModelSignatureMixin">
<a class="viewcode-back" href="../../../../reference/models.html#omegaml.mixins.store.extdmeta.ModelSignatureMixin">[docs]</a>
<span class="linenos">374</span><span class="k">class</span><span class="w"> </span><span class="nc">ModelSignatureMixin</span><span class="p">(</span><span class="n">SignatureMixin</span><span class="p">):</span>
<span class="linenos">375</span>    <span class="nd">@classmethod</span>
<span class="linenos">376</span>    <span class="k">def</span><span class="w"> </span><span class="nf">supports</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">377</span>        <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="n">prefix</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;models/&#39;</span><span class="p">)</span>
<span class="linenos">378</span>
<div class="viewcode-block" id="ModelSignatureMixin.link_dataset">
<a class="viewcode-back" href="../../../../reference/models.html#omegaml.mixins.store.extdmeta.ModelSignatureMixin.link_dataset">[docs]</a>
<span class="linenos">379</span>    <span class="k">def</span><span class="w"> </span><span class="nf">link_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">Xname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Yname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Xmeta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ymeta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos">380</span>                     <span class="n">rName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_store</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos">381</span>                     <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">382</span><span class="w">        </span><span class="sd">&quot;&quot;&quot; link dataset information to this model</span>
<span class="linenos">383</span>
<span class="linenos">384</span><span class="sd">        This sets the &#39;dataset&#39; entry in metadata.attributes of a model. By default</span>
<span class="linenos">385</span><span class="sd">        this method is called by any .fit() call initiated from the runtime. The &#39;dataset&#39;</span>
<span class="linenos">386</span><span class="sd">        entry is a dict that records the following information::</span>
<span class="linenos">387</span>
<span class="linenos">388</span><span class="sd">            {</span>
<span class="linenos">389</span><span class="sd">                &#39;Xname&#39;: Xname,  # the X dataset</span>
<span class="linenos">390</span><span class="sd">                &#39;Yname&#39;: Yname,  # the Y dataset</span>
<span class="linenos">391</span><span class="sd">                &#39;features&#39;: features, # features for this model</span>
<span class="linenos">392</span><span class="sd">                &#39;labels&#39;: labels, # labels for this model</span>
<span class="linenos">393</span><span class="sd">                &#39;Xmeta&#39;: Xmeta, # Metadata for this model (at time of fit)</span>
<span class="linenos">394</span><span class="sd">                &#39;Ymeta&#39;: Ymeta, # Metadata for this model (at time of fit)</span>
<span class="linenos">395</span><span class="sd">                &#39;rName&#39;: rName, # the result dataset</span>
<span class="linenos">396</span><span class="sd">                &#39;kwargs&#39;: kwargs, # other kwargs used for fitting</span>
<span class="linenos">397</span><span class="sd">            }</span>
<span class="linenos">398</span>
<span class="linenos">399</span><span class="sd">        Args:</span>
<span class="linenos">400</span><span class="sd">            name (str): the name of the model or script</span>
<span class="linenos">401</span><span class="sd">            Xname (str): the name of dataset, may include modifiers</span>
<span class="linenos">402</span><span class="sd">            Yname (str): the name of dataset, may include modifiers</span>
<span class="linenos">403</span><span class="sd">            rName (str): the result dataset</span>
<span class="linenos">404</span><span class="sd">            Xmeta (Metadata): the Metadata for X (features), defaults to data_store.metadata(Xname)</span>
<span class="linenos">405</span><span class="sd">            Ymeta (Metadata): the Metadata for Y (features), defaults to data_store.metadata(Yname)</span>
<span class="linenos">406</span><span class="sd">            features (list|dict): a list of feature names or dict(name=info), where info is a</span>
<span class="linenos">407</span><span class="sd">               dict with further information for each features</span>
<span class="linenos">408</span><span class="sd">            labels (list|dict): a list of label names or dict(label=info), where info is a</span>
<span class="linenos">409</span><span class="sd">               dict with futher information for each label</span>
<span class="linenos">410</span><span class="sd">            signature (bool): if True the object&#39;s signature will also be updated, defaults to True</span>
<span class="linenos">411</span><span class="sd">            meta (Metadata): the metadata object, if provided .metadata() is not called again</span>
<span class="linenos">412</span><span class="sd">            data_store (OmegaStore): the data store to retrieve Xmeta, Ymeta if not provided</span>
<span class="linenos">413</span><span class="sd">            **kwargs: passed to self.metadata(name, **kwargs) to retrieve the model metadata</span>
<span class="linenos">414</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">415</span>        <span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">416</span>        <span class="k">if</span> <span class="n">data_store</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Xname</span> <span class="ow">or</span> <span class="n">Yname</span><span class="p">):</span>
<span class="linenos">417</span>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Specify data_store=om.store to store metadata&#39;</span><span class="p">)</span>
<span class="linenos">418</span>        <span class="n">metaX</span> <span class="o">=</span> <span class="p">(</span><span class="n">Xmeta</span> <span class="ow">or</span> <span class="n">data_store</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">Xname</span><span class="p">))</span><span class="o">.</span><span class="n">to_mongo</span><span class="p">()</span> <span class="k">if</span> <span class="n">Xname</span> <span class="ow">and</span> <span class="n">data_store</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos">419</span>        <span class="n">metaY</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ymeta</span> <span class="ow">or</span> <span class="n">data_store</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">Yname</span><span class="p">))</span><span class="o">.</span><span class="n">to_mongo</span><span class="p">()</span> <span class="k">if</span> <span class="n">Yname</span> <span class="ow">and</span> <span class="n">data_store</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos">420</span>        <span class="n">model_attrs</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">421</span>            <span class="s1">&#39;Xname&#39;</span><span class="p">:</span> <span class="n">Xname</span><span class="p">,</span>
<span class="linenos">422</span>            <span class="s1">&#39;Yname&#39;</span><span class="p">:</span> <span class="n">Yname</span><span class="p">,</span>
<span class="linenos">423</span>            <span class="s1">&#39;features&#39;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span>
<span class="linenos">424</span>            <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">labels</span><span class="p">,</span>
<span class="linenos">425</span>            <span class="s1">&#39;Xmeta&#39;</span><span class="p">:</span> <span class="n">metaX</span><span class="p">,</span>
<span class="linenos">426</span>            <span class="s1">&#39;Ymeta&#39;</span><span class="p">:</span> <span class="n">metaY</span><span class="p">,</span>
<span class="linenos">427</span>            <span class="s1">&#39;rName&#39;</span><span class="p">:</span> <span class="n">rName</span><span class="p">,</span>
<span class="linenos">428</span>            <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span>
<span class="linenos">429</span>        <span class="p">}</span>
<span class="linenos">430</span>        <span class="n">meta</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;dataset&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">431</span>        <span class="n">meta</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model_attrs</span><span class="p">)</span>
<span class="linenos">432</span>        <span class="k">if</span> <span class="n">signature</span><span class="p">:</span>
<span class="linenos">433</span>            <span class="bp">self</span><span class="o">.</span><span class="n">link_datatype</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datatype_from_metadata</span><span class="p">(</span><span class="n">metaX</span><span class="p">),</span>
<span class="linenos">434</span>                               <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">)</span> <span class="k">if</span> <span class="n">metaX</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos">435</span>            <span class="bp">self</span><span class="o">.</span><span class="n">link_datatype</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_datatype_from_metadata</span><span class="p">(</span><span class="n">metaY</span><span class="p">),</span>
<span class="linenos">436</span>                               <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">)</span> <span class="k">if</span> <span class="n">metaY</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos">437</span>        <span class="k">return</span> <span class="n">meta</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>

<span class="linenos">438</span>
<span class="linenos">439</span>    <span class="k">def</span><span class="w"> </span><span class="nf">link_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">440</span>        <span class="c1"># TODO determine exact use and implementation</span>
<span class="linenos">441</span>        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">442</span>        <span class="k">return</span> <span class="n">meta</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="linenos">443</span>
<span class="linenos">444</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_dataset_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">445</span>        <span class="c1"># use the linked dataset name if Xname == &#39;*&#39;</span>
<span class="linenos">446</span>        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">447</span>        <span class="n">is_default</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="linenos">448</span>
<span class="linenos">449</span>        <span class="k">def</span><span class="w"> </span><span class="nf">apply_default</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">450</span>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">is_default</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
<span class="linenos">451</span>                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="linenos">452</span>
<span class="linenos">453</span>        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
<span class="linenos">454</span>        <span class="n">dataset_meta</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">455</span>        <span class="n">Xname</span> <span class="o">=</span> <span class="n">dataset_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Xname&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_default</span><span class="p">(</span><span class="n">Xname</span><span class="p">)</span> <span class="k">else</span> <span class="n">Xname</span>
<span class="linenos">456</span>        <span class="p">[</span><span class="n">apply_default</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Yname&#39;</span><span class="p">,</span> <span class="s1">&#39;rName&#39;</span><span class="p">)]</span>
<span class="linenos">457</span>        <span class="k">return</span> <span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">),</span> <span class="n">kwargs</span>
<span class="linenos">458</span>
<span class="linenos">459</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_post_fit_link_dataset_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_store</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">460</span>        <span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">461</span>        <span class="bp">self</span><span class="o">.</span><span class="n">link_dataset</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="o">=</span><span class="n">Xname</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">data_store</span><span class="o">=</span><span class="n">data_store</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">462</span>        <span class="k">return</span> <span class="n">result</span>
<span class="linenos">463</span>
<span class="linenos">464</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">465</span>        <span class="c1"># get default Xname, Yname if provided as &#39;*&#39;</span>
<span class="linenos">466</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dataset_defaults</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">467</span>
<span class="linenos">468</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_partial_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">469</span>        <span class="c1"># get default Xname, Yname if provided as &#39;*&#39;</span>
<span class="linenos">470</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dataset_defaults</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">471</span>
<span class="linenos">472</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_post_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">473</span>        <span class="c1"># link the input dataset names with</span>
<span class="linenos">474</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_fit_link_dataset_</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">475</span>
<span class="linenos">476</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_post_partial_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">477</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_fit_link_dataset_</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">478</span>
<span class="linenos">479</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">480</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dataset_defaults</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">481</span>
<span class="linenos">482</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_post_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">483</span>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
<span class="linenos">484</span>        <span class="k">return</span> <span class="n">result</span>
<span class="linenos">485</span>
<span class="linenos">486</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_decision_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">487</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dataset_defaults</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">488</span>
<span class="linenos">489</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">490</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dataset_defaults</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">491</span>
<span class="linenos">492</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">493</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dataset_defaults</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">494</span>
<span class="linenos">495</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">496</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dataset_defaults</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos">497</span>
<span class="linenos">498</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pre_fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos">499</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dataset_defaults</span><span class="p">(</span><span class="n">modelname</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="linenos">500</span>
<span class="linenos">501</span>
<span class="linenos">502</span><span class="n">schema_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 (c) omegaml.io by one2seven GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <!-- version plugin for rtd template without sidebar -->
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: stable
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../../../0.11.3/index.html" class="version-ref-0.11.3">0.11.3</a></dd>
      <dd><a href="../../../../../0.11.4/index.html" class="version-ref-0.11.4">0.11.4</a></dd>
      <dd><a href="../../../../../0.12.0/index.html" class="version-ref-0.12.0">0.12.0</a></dd>
      <dd><a href="../../../../../0.13.0/index.html" class="version-ref-0.13.0">0.13.0</a></dd>
      <dd><a href="../../../../../0.13.2/index.html" class="version-ref-0.13.2">0.13.2</a></dd>
      <dd><a href="../../../../../0.13.4/index.html" class="version-ref-0.13.4">0.13.4</a></dd>
      <dd><a href="../../../../../0.13.5/index.html" class="version-ref-0.13.5">0.13.5</a></dd>
      <dd><a href="../../../../../0.13.6/index.html" class="version-ref-0.13.6">0.13.6</a></dd>
      <dd><a href="../../../../../0.13.7/index.html" class="version-ref-0.13.7">0.13.7</a></dd>
      <dd><a href="../../../../../0.14.0/index.html" class="version-ref-0.14.0">0.14.0</a></dd>
      <dd><a href="../../../../../0.15.1/index.html" class="version-ref-0.15.1">0.15.1</a></dd>
      <dd><a href="../../../../../0.15.2/index.html" class="version-ref-0.15.2">0.15.2</a></dd>
      <dd><a href="../../../../../latest/index.html" class="version-ref-latest">latest</a></dd>
      <dd><a href="../../../../../release/0.15.3/index.html" class="version-ref-release/0.15.3">0.15.3</a></dd>
      <dd><a href="../../../../../release/0.15.5/index.html" class="version-ref-release/0.15.5">0.15.5</a></dd>
      <dd><a href="../../../../../release/0.16.0/index.html" class="version-ref-release/0.16.0">0.16.0</a></dd>
      <dd><a href="../../../../../release/0.16.1/index.html" class="version-ref-release/0.16.1">0.16.1</a></dd>
      <dd><a href="../../../../../release/0.16.2/index.html" class="version-ref-release/0.16.2">0.16.2</a></dd>
      <dd><a href="../../../../../release/0.16.3/index.html" class="version-ref-release/0.16.3">0.16.3</a></dd>
      <dd><a href="../../../../../release/0.16.4/index.html" class="version-ref-release/0.16.4">0.16.4</a></dd>
      <dd><a href="../../../../../release/0.4/index.html" class="version-ref-release/0.4">0.4</a></dd>
      <dd><a href="../../../../../release/0.5/index.html" class="version-ref-release/0.5">0.5</a></dd>
      <dd><a href="../../../../../release/0.9/index.html" class="version-ref-release/0.9">0.9</a></dd>
      <dd><a href="extdmeta.html" class="version-ref-stable">stable</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../../../master/index.html">master</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>