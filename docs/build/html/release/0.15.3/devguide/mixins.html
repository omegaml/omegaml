

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mixins &mdash; omega-ml 1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=bf4bd5a2" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=56dcb7b8"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reference" href="../reference/index.html" />
    <link rel="prev" title="Storage backends" href="storage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            omega-ml
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Administration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Development Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom.html">Custom development</a></li>
<li class="toctree-l2"><a class="reference internal" href="metadata.html">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="storage.html">Storage backends</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Mixins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#storage-mixins">Storage mixins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-mixins">Runtime mixins</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nb/index.html">Tutorial Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../screenshots.html">Screenshots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../moreinfo.html">More information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">omega-ml</a>
      </nav>

      <div class="wy-nav-content">

<div class="version-warning-banner">
    
    You're reading an old version of this documentation.
    If you want up-to-date information, please have a look at <a href="../../0.16.4/devguide/mixins.html">release/0.16.4</a>.
    
</div>


        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Development Guide</a></li>
      <li class="breadcrumb-item active">Mixins</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/devguide/mixins.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mixins">
<h1>Mixins<a class="headerlink" href="#mixins" title="Link to this heading">¶</a></h1>
<p>Mixins come in several flavors:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">OmegaStore</span></code> mixins, enabling data pre-/post processing</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">MDataFrame</span></code> mixins, enabling custom operations on lazy-evaluation dataframes</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">OmegaModelProxy</span></code> mixins, enabling tasks to run on the compute cluster</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">MDataFrame,</span> <span class="pre">MSeries</span></code> mixins, enabling custom operations on MDataFrame and MSeries objects</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">ApplyContext</span></code> mixins, enabling custom operations in <code class="code docutils literal notranslate"><span class="pre">apply()</span></code> contexts</p></li>
</ul>
<section id="storage-mixins">
<h2>Storage mixins<a class="headerlink" href="#storage-mixins" title="Link to this heading">¶</a></h2>
<p>Storage mixins typically override the <code class="code docutils literal notranslate"><span class="pre">get</span></code> and <code class="code docutils literal notranslate"><span class="pre">put</span></code> methods
to extend the functionality of backends.</p>
<p>Consider users intend to store plain-text Yaml documents, which is not
natively supported by any of the existing backends. However the default
backend supports storing Python dictionaries, so we could ask the user to
convert the Yaml documents to Pyton dictionaries first, and then use
<code class="code docutils literal notranslate"><span class="pre">om.datasets.put</span></code> to store the object.</p>
<p>As a convenience to users, we provide this conversion in a storage mixin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">YamlDataMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
       <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="ow">or</span> <span class="p">{}</span>
       <span class="k">try</span><span class="p">:</span>
          <span class="n">obj</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
       <span class="k">except</span><span class="p">:</span>
          <span class="k">pass</span> <span class="c1"># assume obj was some other valid type</span>
       <span class="k">else</span><span class="p">:</span>
          <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;as_yaml&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
       <span class="c1"># call the default implementation</span>
       <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">YamlDataMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
                                            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

   <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
       <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
       <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">YamlDataMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
       <span class="k">if</span> <span class="n">meta</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;as_yaml&#39;</span><span class="p">):</span>
           <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
       <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>To enable this mixin, call <code class="code docutils literal notranslate"><span class="pre">om.datasets.register_mixin</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># on startup</span>
<span class="n">om</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">register_mixin</span><span class="p">(</span><span class="n">YamlDataMixin</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Celery clusters require that the module providing YamlDaskMixin is available on
both the client and the worker instance. This limitation is planned
to be removed in future versions of omega-ml using ccbackend, which provides
for arbitrary functions to be executed on a celery cluster. Dask Distributed
clusters do not have this limitation.</p>
</div>
</section>
<section id="runtime-mixins">
<h2>Runtime mixins<a class="headerlink" href="#runtime-mixins" title="Link to this heading">¶</a></h2>
<p>Runtime mixins provide client-side extensions to <cite>om.runtime</cite>, specifically
to <code class="code docutils literal notranslate"><span class="pre">OmegaModelProxy</span></code>. OmegalModelProxy is responsible for submitting
user-requested functions to the compute cluster.</p>
<p>Consider users want to run a cross-validation procedure in some particular
way that is not supported by the default runtime. While they could use
a job (notebook) to accomplish this, we provide a runtime mixin as a
convenience.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># in crossvalidate.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CrossValidationMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cross_validate</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="n">Yname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="c1"># get the cross validation task</span>
         <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="s1">&#39;custom.tasks.cross_validate&#39;</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="n">Yname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c1"># in custom.tasks</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cross_validate</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">Xname</span><span class="p">,</span> <span class="n">Yname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
   <span class="c1"># get model and data</span>
   <span class="n">model</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
   <span class="n">xdata</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Xname</span><span class="p">)</span>
   <span class="n">ydata</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Yname</span><span class="p">)</span>
   <span class="c1"># perform cross validation</span>
   <span class="n">results</span> <span class="o">=</span> <span class="o">...</span>
   <span class="c1">#</span>
   <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
<p>To enable this mixin, add the class to <code class="code docutils literal notranslate"><span class="pre">om.defaults.OMEGA_RUNTIME_MIXINS</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OMEGA_STORE_MIXINS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">&#39;crossvalidate.CrossValidationMixin&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Celery clusters require that the custom.tasks module is available on
both the client and the worker instance. This limitation is planned
to be removed in future versions of omega-ml using ccbackend, which provides
for arbitrary functions to be executed on a celery cluster. Dask Distributed
clusters do not have this limitation.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="storage.html" class="btn btn-neutral float-left" title="Storage backends" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../reference/index.html" class="btn btn-neutral float-right" title="Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 (c) omegaml.io by one2seven GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <!-- version plugin for rtd template without sidebar -->
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: release/0.15.3
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../0.11.3/devguide/mixins.html" class="version-ref-0.11.3">0.11.3</a></dd>
      <dd><a href="../../../0.11.4/devguide/mixins.html" class="version-ref-0.11.4">0.11.4</a></dd>
      <dd><a href="../../../0.12.0/devguide/mixins.html" class="version-ref-0.12.0">0.12.0</a></dd>
      <dd><a href="../../../0.13.0/devguide/mixins.html" class="version-ref-0.13.0">0.13.0</a></dd>
      <dd><a href="../../../0.13.2/devguide/mixins.html" class="version-ref-0.13.2">0.13.2</a></dd>
      <dd><a href="../../../0.13.4/devguide/mixins.html" class="version-ref-0.13.4">0.13.4</a></dd>
      <dd><a href="../../../0.13.5/devguide/mixins.html" class="version-ref-0.13.5">0.13.5</a></dd>
      <dd><a href="../../../0.13.6/devguide/mixins.html" class="version-ref-0.13.6">0.13.6</a></dd>
      <dd><a href="../../../0.13.7/devguide/mixins.html" class="version-ref-0.13.7">0.13.7</a></dd>
      <dd><a href="../../../0.14.0/devguide/mixins.html" class="version-ref-0.14.0">0.14.0</a></dd>
      <dd><a href="../../../0.15.1/devguide/mixins.html" class="version-ref-0.15.1">0.15.1</a></dd>
      <dd><a href="../../../0.15.2/devguide/mixins.html" class="version-ref-0.15.2">0.15.2</a></dd>
      <dd><a href="../../../latest/devguide/mixins.html" class="version-ref-latest">latest</a></dd>
      <dd><a href="mixins.html" class="version-ref-release/0.15.3">0.15.3</a></dd>
      <dd><a href="../../0.15.5/devguide/mixins.html" class="version-ref-release/0.15.5">0.15.5</a></dd>
      <dd><a href="../../0.16.0/devguide/mixins.html" class="version-ref-release/0.16.0">0.16.0</a></dd>
      <dd><a href="../../0.16.1/devguide/mixins.html" class="version-ref-release/0.16.1">0.16.1</a></dd>
      <dd><a href="../../0.16.2/devguide/mixins.html" class="version-ref-release/0.16.2">0.16.2</a></dd>
      <dd><a href="../../0.16.3/devguide/mixins.html" class="version-ref-release/0.16.3">0.16.3</a></dd>
      <dd><a href="../../0.16.4/devguide/mixins.html" class="version-ref-release/0.16.4">0.16.4</a></dd>
      <dd><a href="../../0.4/index.html" class="version-ref-release/0.4">0.4</a></dd>
      <dd><a href="../../0.5/index.html" class="version-ref-release/0.5">0.5</a></dd>
      <dd><a href="../../0.9/devguide/mixins.html" class="version-ref-release/0.9">0.9</a></dd>
      <dd><a href="../../../stable/devguide/mixins.html" class="version-ref-stable">stable</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../master/devguide/mixins.html">master</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>