

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Design &mdash; omega-ml 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=bf4bd5a2" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            omega-ml
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devguide/index.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../screenshots.html">Screenshots</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">omega-ml</a>
      </nav>

      <div class="wy-nav-content">

<div class="version-warning-banner">
    
    You're reading an old version of this documentation.
    If you want up-to-date information, please have a look at <a href="../../0.16.4/admin/design.html">release/0.16.4</a>.
    
</div>


        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Design</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/admin/design.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="design">
<h1>Design<a class="headerlink" href="#design" title="Link to this heading">¶</a></h1>
<section id="omega-runtime">
<h2>omega runtime<a class="headerlink" href="#omega-runtime" title="Link to this heading">¶</a></h2>
<p>The runtime implements remote execution of models and jobs. The runtime
is implemented as follows:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">OmegaRuntime</span></code> - the client API to get access to a remote model</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">OmegaModelProxy</span></code> - the client API to the remote model</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">runtime.tasks</span></code> - the celery tasks implementing the actual execution</p></li>
</ul>
<p>A <code class="code docutils literal notranslate"><span class="pre">OmegaRuntime</span></code> instance is available as <code class="code docutils literal notranslate"><span class="pre">om.runtime</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">om</span> <span class="o">=</span> <span class="n">Omega</span><span class="p">()</span>
<span class="c1"># get the OmegaModelProxy instance</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;mymodel&#39;</span><span class="p">)</span>
<span class="c1"># call methods on OmegaModelProxy, effecting remote task execution</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that any method called on the <code class="code docutils literal notranslate"><span class="pre">model</span></code> are translated into calls
to respective celery tasks. A celery task lives in a celery worker at a remote
note. On execution a task will re-create the <code class="code docutils literal notranslate"><span class="pre">Omega</span></code> instance to retrieve
the <em>X,Y</em> data as well as the actual model.</p>
<p>This raises the question where a task gets the configuration for recreating
the <code class="code docutils literal notranslate"><span class="pre">Omega</span></code> instance. The only configuration option required for a task
is the <code class="code docutils literal notranslate"><span class="pre">mongo_url</span></code>, which specifies the database and access credentials
where data and models are stored. As the task does not need to configure
the runtime, it does not need any of the <code class="code docutils literal notranslate"><span class="pre">OmegaRuntime</span></code> configuration.</p>
<p>Various options:</p>
<ul class="simple">
<li><p><strong>run per-user celery workers</strong>: In this case there are 1-n celery workers
pre-configured to run for a particular user. The Omega instance
is configured globally as it would be when run in a client. This option
requires a per-user deployment process where celery workers are spun up and
task routes configured. The <code class="code docutils literal notranslate"><span class="pre">OmegaModelProxy</span></code> then executes tasks
using a the user-specific celery route/queue. This is the golden option
for the runtime as it was originally designed by this assumption. However
this adds a lot of complexity to the deployment process which we are not
yet ready to support.</p></li>
<li><p><strong>pass the user identification to the task</strong>: In this case the task needs
to be able to look up the configuration from a database. This requires the
need for user information stored in a database accessible to Omega. The
only database accessible to it is mongodb, which however does not have
user information. In fact, the database model used by Omega is on purpose
single user (to keep it as simple as possible). Thus introducing the concept
of user configuration into the Omega database just for remote task execution
adds complexity that we should avoid.</p></li>
<li><p><strong>pass the actual configuration</strong>: In this case the task gets all necessary
configuration from the client, namely the <cite>mongo_url</cite>. This is in line with
how Omega itself gets the configuration. Also this does not suffer
from adding the complexity of user authentication to Omega. This option also
leaves open the possibility to have user-specific deployments (as described
above) without introducing additional overhead. The downside is that the
mongo_url needs to be passed via network and thus is exposed through the
communication to the broker. The other options do not suffer from this
weakness. However this is a security concern best addressed by protecting
communication. All things considered this is the most straight-forward
option both in terms of additional complexity (none), future flexibility
and the ease of implementation. Hence this is the option we choose.</p></li>
</ul>
</section>
<section id="security-concerns">
<h2>Security concerns<a class="headerlink" href="#security-concerns" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>user authentication</strong>. Users authenticate to REST endpoints by username +
Apikey. Communication is protected by HTTPS.</p></li>
<li><p><strong>the database</strong> is protected by user/passwords. There is an admin database
which uses the <code class="code docutils literal notranslate"><span class="pre">MONGO_ADMIN_URL</span></code>. This URL is not exposed to
users. The per-user databases are only exposed on a per-user basis.</p></li>
<li><p><strong>communication to the database</strong> is currently <strong>not protected</strong>. This needs
to be addressed (mongo TSL support).</p></li>
<li><p><strong>communication to the message broker</strong> is currently <strong>not protected</strong>. This needs
to be addressed (access protection to RabbitMQ, channel encryption (TLS) and
possibly celery message signing).</p></li>
<li><p><strong>configuration stored on the client</strong>. REST clients only need to store username
+ apikey. Clients interfacing to the datastore via an <code class="code docutils literal notranslate"><span class="pre">Omega</span></code> instance
directly only need to store the <code class="code docutils literal notranslate"><span class="pre">mongo_url</span></code>. Clients interfacing
with the <code class="code docutils literal notranslate"><span class="pre">OmegaRuntime</span></code> need to store the broker URL +
user credentials. Clients interfacing with a combination of the above need
to store all credentials. Most clients will only need either mongo_url or
username + apikey, with only few clients interfacing directly with the
<cite>OmegaRuntime</cite> (only needed for performance reasons in case of large answers
to predictions, all other clients should use the REST endpoints).</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 (c) omegaml.io by one2seven GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <!-- version plugin for rtd template without sidebar -->
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: release/0.9
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../0.11.3/admin/design.html" class="version-ref-0.11.3">0.11.3</a></dd>
      <dd><a href="../../../0.11.4/admin/design.html" class="version-ref-0.11.4">0.11.4</a></dd>
      <dd><a href="../../../0.12.0/admin/design.html" class="version-ref-0.12.0">0.12.0</a></dd>
      <dd><a href="../../../0.13.0/admin/design.html" class="version-ref-0.13.0">0.13.0</a></dd>
      <dd><a href="../../../0.13.2/admin/design.html" class="version-ref-0.13.2">0.13.2</a></dd>
      <dd><a href="../../../0.13.4/admin/design.html" class="version-ref-0.13.4">0.13.4</a></dd>
      <dd><a href="../../../0.13.5/admin/design.html" class="version-ref-0.13.5">0.13.5</a></dd>
      <dd><a href="../../../0.13.6/admin/design.html" class="version-ref-0.13.6">0.13.6</a></dd>
      <dd><a href="../../../0.13.7/admin/design.html" class="version-ref-0.13.7">0.13.7</a></dd>
      <dd><a href="../../../0.14.0/admin/design.html" class="version-ref-0.14.0">0.14.0</a></dd>
      <dd><a href="../../../0.15.1/admin/design.html" class="version-ref-0.15.1">0.15.1</a></dd>
      <dd><a href="../../../0.15.2/admin/design.html" class="version-ref-0.15.2">0.15.2</a></dd>
      <dd><a href="../../../latest/admin/design.html" class="version-ref-latest">latest</a></dd>
      <dd><a href="../../0.15.3/admin/design.html" class="version-ref-release/0.15.3">0.15.3</a></dd>
      <dd><a href="../../0.15.5/admin/design.html" class="version-ref-release/0.15.5">0.15.5</a></dd>
      <dd><a href="../../0.16.0/admin/design.html" class="version-ref-release/0.16.0">0.16.0</a></dd>
      <dd><a href="../../0.16.1/admin/design.html" class="version-ref-release/0.16.1">0.16.1</a></dd>
      <dd><a href="../../0.16.2/admin/design.html" class="version-ref-release/0.16.2">0.16.2</a></dd>
      <dd><a href="../../0.16.3/admin/design.html" class="version-ref-release/0.16.3">0.16.3</a></dd>
      <dd><a href="../../0.16.4/admin/design.html" class="version-ref-release/0.16.4">0.16.4</a></dd>
      <dd><a href="../../0.4/index.html" class="version-ref-release/0.4">0.4</a></dd>
      <dd><a href="../../0.5/index.html" class="version-ref-release/0.5">0.5</a></dd>
      <dd><a href="design.html" class="version-ref-release/0.9">0.9</a></dd>
      <dd><a href="../../../stable/admin/design.html" class="version-ref-stable">stable</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../master/admin/design.html">master</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>