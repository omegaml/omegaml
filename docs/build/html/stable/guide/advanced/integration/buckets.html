

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multiple environments &mdash; omega-ml 0.16.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=bf4bd5a2" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=81998473"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Customizing omega-ml" href="../customizing/index.html" />
    <link rel="prev" title="Runtime Clusters" href="runtimes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            omega-ml
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/index.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../intro/index.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../datasets/index.html">Working with datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/index.html">Working with models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/index.html">Working with notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scripts/index.html">Working with scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../streams/index.html">Working with streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../clusters/index.html">Deploying models and pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/index.html">Command-line interface</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Advanced features</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Working with clusters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="runtimes.html">Runtime Clusters</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Multiple environments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../customizing/index.html">Customizing omega-ml</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration/index.html">Integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devguide/index.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nb/index.html">Tutorial Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../screenshots.html">Screenshots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../moreinfo.html">More information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes/index.html">Changes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">omega-ml</a>
      </nav>

      <div class="wy-nav-content">


        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">User Guide</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Advanced features</a></li>
          <li class="breadcrumb-item"><a href="index.html">Working with clusters</a></li>
      <li class="breadcrumb-item active">Multiple environments</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/guide/advanced/integration/buckets.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="multiple-environments">
<h1>Multiple environments<a class="headerlink" href="#multiple-environments" title="Link to this heading">¶</a></h1>
<p>omega-ml provides three concepts to work with multiple environments, each focussed on a specific need.</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">context</span></code> - a context provides a completely seperate environment, where all datasets, models,
jobs as well as the runtime is distinct from any other other context. Think of this is the equivalent
of a seperate account.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">buckets</span></code> - a bucket is a logical subset of a context. It utilizes the same database and the
same runtime as any other bucket within the same context. Think of this a a top-level folder in
an other-wise shared environment.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">routing</span></code> - tasks submitted to the runtime can specify resource requirements, which
effectively route tasks to different workers. Multiple contexts can use the same runtime resources.
Think of this as compute cluster segregation e.g. by client or project.</p></li>
</ul>
<section id="working-with-contexts">
<h2>Working with Contexts<a class="headerlink" href="#working-with-contexts" title="Link to this heading">¶</a></h2>
<p>omega-ml contexts are created by calling the <code class="code docutils literal notranslate"><span class="pre">om.setup()</span></code> function, returning a configured
<code class="code docutils literal notranslate"><span class="pre">Omega()</span></code> instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># development environment</span>
<span class="n">om_dev</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">mongo_url</span><span class="o">=....</span><span class="p">,</span> <span class="n">celeryconf</span><span class="o">=....</span><span class="p">)</span>
<span class="c1"># production environment</span>
<span class="n">om_prod</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">mongo_url</span><span class="o">=....</span><span class="p">,</span> <span class="n">celeryconf</span><span class="o">=....</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="working-with-buckets">
<h2>Working with Buckets<a class="headerlink" href="#working-with-buckets" title="Link to this heading">¶</a></h2>
<p>Each <code class="code docutils literal notranslate"><span class="pre">Omega</span></code> instance is configured to a particular bucket, the default being <code class="code docutils literal notranslate"><span class="pre">omega</span></code>. To
get an instantance configured for an other bucket use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">om_foo</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;mybucket&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Buckets are an easy built-in way to separate environments, projects and users. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># an environment for user1</span>
<span class="n">om_user1</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;user1&#39;</span><span class="p">]</span>
<span class="c1"># an environment for project_a</span>
<span class="n">om_prjA</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;projec_a&#39;</span><span class="p">]</span>
<span class="c1"># development</span>
<span class="n">om_dev</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]</span>
<span class="c1"># production</span>
<span class="n">om_prod</span> <span class="o">=</span> <span class="n">om</span><span class="p">[</span><span class="s1">&#39;prod&#39;</span><span class="p">]</span>
<span class="c1"># etc.</span>
</pre></div>
</div>
</section>
<section id="promoting-objects-between-contexts-and-environments">
<h2>Promoting objects between contexts and environments<a class="headerlink" href="#promoting-objects-between-contexts-and-environments" title="Link to this heading">¶</a></h2>
<p>Object promotion copies objects from one context to another, more specifically from one bucket to another bucket.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Promoition is more than a simple copy: Some objects may require conditions to be met
(e.g. a model must be trained) before the promotion works. The default implementation
of object promotion does not impose any conditions and works as a copy/replace.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">om_dev</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">promote</span><span class="p">(</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">om_prod</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span>
<span class="n">om_dev</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">promote</span><span class="p">(</span><span class="s1">&#39;sales-prediction&#39;</span><span class="p">,</span> <span class="n">om_prod</span><span class="o">.</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="working-with-runtime-routing">
<h2>Working with runtime routing<a class="headerlink" href="#working-with-runtime-routing" title="Link to this heading">¶</a></h2>
<p>When using <code class="code docutils literal notranslate"><span class="pre">om.runtime</span></code> tasks are submitted to a runtime worker. A runtime worker is any compute
node that runs an omegaml worker. Tasks are submitted by sending a message to a celery queue, by default all tasks
are routed to the :code:’default` queue. Any other queue can be specified:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># this will route the fit task to a gpu node</span>
<span class="n">om</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="s1">&#39;gpu&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;mymodel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The same can be achieved on the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>om<span class="w"> </span>runtime<span class="w"> </span>--require<span class="w"> </span>gpu<span class="w"> </span>model<span class="w"> </span>mymodel<span class="w"> </span>fit<span class="w"> </span>...
</pre></div>
</div>
<p>Similarly, the runtime provides a local option which means the task is run locally. This is useful for debugging, e.g.
when running a script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">om</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;mymodel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Models can be permanently bound to a particular route by specifying the queue name in the model’s metadata
attributes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># specify the .require() value as part of the metadata</span>
<span class="n">specs</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;gpu&#39;</span>
<span class="p">}</span>
<span class="n">om</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="s1">&#39;mymodel&#39;</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">require</span><span class="o">=</span><span class="n">specs</span><span class="p">))</span>

<span class="c1"># using the runtime will automatically apply .require(&#39;gpu&#39;)</span>
<span class="n">om</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;regmodel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="runtimes.html" class="btn btn-neutral float-left" title="Runtime Clusters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../customizing/index.html" class="btn btn-neutral float-right" title="Customizing omega-ml" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 (c) omegaml.io by one2seven GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <!-- version plugin for rtd template without sidebar -->
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: stable
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../../0.11.3/index.html" class="version-ref-0.11.3">0.11.3</a></dd>
      <dd><a href="../../../../0.11.4/index.html" class="version-ref-0.11.4">0.11.4</a></dd>
      <dd><a href="../../../../0.12.0/index.html" class="version-ref-0.12.0">0.12.0</a></dd>
      <dd><a href="../../../../0.13.0/index.html" class="version-ref-0.13.0">0.13.0</a></dd>
      <dd><a href="../../../../0.13.2/index.html" class="version-ref-0.13.2">0.13.2</a></dd>
      <dd><a href="../../../../0.13.4/index.html" class="version-ref-0.13.4">0.13.4</a></dd>
      <dd><a href="../../../../0.13.5/index.html" class="version-ref-0.13.5">0.13.5</a></dd>
      <dd><a href="../../../../0.13.6/index.html" class="version-ref-0.13.6">0.13.6</a></dd>
      <dd><a href="../../../../0.13.7/guide/advanced/integration/buckets.html" class="version-ref-0.13.7">0.13.7</a></dd>
      <dd><a href="../../../../0.14.0/guide/advanced/integration/buckets.html" class="version-ref-0.14.0">0.14.0</a></dd>
      <dd><a href="../../../../0.15.1/guide/advanced/integration/buckets.html" class="version-ref-0.15.1">0.15.1</a></dd>
      <dd><a href="../../../../0.15.2/guide/advanced/integration/buckets.html" class="version-ref-0.15.2">0.15.2</a></dd>
      <dd><a href="../../../../latest/guide/advanced/integration/buckets.html" class="version-ref-latest">latest</a></dd>
      <dd><a href="../../../../release/0.15.3/guide/advanced/integration/buckets.html" class="version-ref-release/0.15.3">0.15.3</a></dd>
      <dd><a href="../../../../release/0.15.5/guide/advanced/integration/buckets.html" class="version-ref-release/0.15.5">0.15.5</a></dd>
      <dd><a href="../../../../release/0.16.0/guide/advanced/integration/buckets.html" class="version-ref-release/0.16.0">0.16.0</a></dd>
      <dd><a href="../../../../release/0.16.1/guide/advanced/integration/buckets.html" class="version-ref-release/0.16.1">0.16.1</a></dd>
      <dd><a href="../../../../release/0.16.2/guide/advanced/integration/buckets.html" class="version-ref-release/0.16.2">0.16.2</a></dd>
      <dd><a href="../../../../release/0.16.3/guide/advanced/integration/buckets.html" class="version-ref-release/0.16.3">0.16.3</a></dd>
      <dd><a href="../../../../release/0.16.4/guide/advanced/integration/buckets.html" class="version-ref-release/0.16.4">0.16.4</a></dd>
      <dd><a href="../../../../release/0.4/index.html" class="version-ref-release/0.4">0.4</a></dd>
      <dd><a href="../../../../release/0.5/index.html" class="version-ref-release/0.5">0.5</a></dd>
      <dd><a href="../../../../release/0.9/index.html" class="version-ref-release/0.9">0.9</a></dd>
      <dd><a href="buckets.html" class="version-ref-stable">stable</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../../master/guide/advanced/integration/buckets.html">master</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>